# GradNote-FrontEnd 核心技术与规范

本文档详细说明 GradNote 前端项目的核心技术栈和开发规范，确保团队成员遵循统一的开发标准，提高代码质量和开发效率。

## 1. React & JSX

### 1.1 组件类型

- **优先使用函数组件和 Hooks**：所有新组件应使用函数组件实现，并利用 React Hooks 管理状态和副作用
- **避免使用类组件**：除非有特殊需求，不推荐使用类组件

### 1.2 命名规范

- **组件名**：使用帕斯卡命名法 (PascalCase)，如 `SubmissionForm`、`KnowledgeCard`
- **文件名**：使用帕斯卡命名法，与组件名保持一致，如 `SubmissionForm.jsx`、`KnowledgeCard.jsx`
- **Hook 文件名**：使用小驼峰命名法 (camelCase)，前缀为 `use`，如 `useSubmission.js`、`useKnowledgeReview.js`

### 1.3 组件结构

- **小型组件**：保持组件功能单一，避免过于复杂的组件
- **组件拆分**：当组件超过 300 行或功能复杂时，考虑拆分为多个子组件
- **逻辑分离**：将业务逻辑与 UI 渲染逻辑分离，业务逻辑放入自定义 Hook 中

### 1.4 Props 传递

- **明确 Props 类型**：使用 JSDoc 注释说明 props 类型
- **默认值**：为可选 props 设置合理的默认值
- **避免过度传递**：Props 层级不宜超过 3 层，考虑使用 Context 或 Zustand 管理共享状态

```jsx
/**
 * @param {Object} props
 * @param {string} props.title - 卡片标题
 * @param {Array<string>} props.knowledgePoints - 知识点列表
 * @param {boolean} [props.isReviewed=false] - 是否已审核
 * @param {Function} props.onConfirm - 确认回调函数
 */
function KnowledgeCard({ title, knowledgePoints, isReviewed = false, onConfirm }) {
  // 组件实现
}
```

## 2. 状态管理 (Zustand)

### 2.1 Store 结构

- 按功能模块划分 Store，位于 `src/stores/` 目录下
- 主要 Store 包括：
  - `authStore.js`：用户认证状态
  - `submissionStore.js`：错题提交状态
  - `knowledgeStore.js`：知识点管理状态

### 2.2 State 设计

- 确保状态扁平化，避免深层嵌套
- 使用注释说明状态结构和类型

```js
// src/stores/submissionStore.js
import { create } from 'zustand';

/**
 * 错题提交状态管理
 * @typedef {Object} SubmissionState
 * @property {Array<Object>} images - 上传的图片列表
 * @property {string} questionText - OCR 识别的题目文本
 * @property {string} answerText - OCR 识别的答案文本
 * @property {Array<string>} knowledgePoints - 提取的知识点列表
 * @property {string} solvingProcess - 解题过程
 * @property {boolean} isLoading - 加载状态
 * @property {string|null} error - 错误信息
 */

const useSubmissionStore = create((set) => ({
  // 初始状态
  images: [],
  questionText: '',
  answerText: '',
  knowledgePoints: [],
  solvingProcess: '',
  isLoading: false,
  error: null,
  
  // Actions
  // ...
}));
```

### 2.3 Actions 定义

- 将所有改变状态的逻辑定义为 actions
- 异步 action 使用 async/await 处理

```js
// Actions 示例
const useSubmissionStore = create((set, get) => ({
  // 状态...
  
  // 同步 Action
  setQuestionText: (text) => set({ questionText: text }),
  
  // 异步 Action
  uploadImages: async (files) => {
    set({ isLoading: true, error: null });
    try {
      // 上传逻辑
      const uploadedImages = await uploadImagesToServer(files);
      set({ images: [...get().images, ...uploadedImages], isLoading: false });
    } catch (error) {
      set({ error: error.message, isLoading: false });
    }
  }
}));
```

### 2.4 Selectors 使用

- 使用 selectors 获取状态，避免不必要的重渲染
- 在组件中使用具体的 selector，而不是获取整个状态

```jsx
// 不推荐
const { images, questionText } = useSubmissionStore();

// 推荐
const images = useSubmissionStore(state => state.images);
const questionText = useSubmissionStore(state => state.questionText);
```

## 3. 数据请求与缓存 (Axios & TanStack Query)

### 3.1 Axios 封装

#### 3.1.1 基础配置

- 在 `src/api/axios.config.js` 中配置 Axios 实例
- 设置基础 URL、超时时间、请求/响应拦截器

```js
// src/api/axios.config.js
import axios from 'axios';

const baseURL = process.env.REACT_APP_BACK_END_API_URL || 'http://127.0.0.1:8000/api/v1';

const axiosInstance = axios.create({
  baseURL,
  timeout: 15000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// 请求拦截器 - 添加认证 Token
axiosInstance.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('accessToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// 响应拦截器 - 统一错误处理
axiosInstance.interceptors.response.use(
  (response) => response.data,
  (error) => {
    // 401 错误处理 - 登出并重定向
    if (error.response && error.response.status === 401) {
      localStorage.removeItem('accessToken');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default axiosInstance;
```

#### 3.1.2 API 函数组织

- 按功能模块组织 API 函数，位于 `src/api/` 目录下
- 保持函数命名清晰、一致

```js
// src/api/question.service.js
import axios from './axios.config';

/**
 * 获取错题列表
 * @param {Object} params - 查询参数
 * @returns {Promise<Array>} 错题列表
 */
export const getQuestions = (params) => {
  return axios.get('/questions', { params });
};

/**
 * 创建新错题
 * @param {Object} questionData - 错题数据
 * @returns {Promise<Object>} 创建的错题
 */
export const createQuestion = (questionData) => {
  return axios.post('/questions', questionData);
};

// 更多 API 函数...
```

### 3.2 TanStack Query 使用

#### 3.2.1 全局配置

- 在 `src/queryClient.js` 中配置 TanStack Query

```js
// src/queryClient.js
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5 分钟
      cacheTime: 30 * 60 * 1000, // 30 分钟
      retry: 1,
      refetchOnWindowFocus: false,
    },
  },
});
```

#### 3.2.2 Query Keys 规范

- 使用数组形式定义 query keys，便于管理和失效
- 第一个元素为资源类型，后续元素为参数

```js
// Query Keys 示例
const questionKeys = {
  all: ['questions'],
  lists: () => [...questionKeys.all, 'list'],
  list: (filters) => [...questionKeys.lists(), filters],
  details: () => [...questionKeys.all, 'detail'],
  detail: (id) => [...questionKeys.details(), id],
};
```

#### 3.2.3 useQuery 使用规范

- 使用自定义 Hook 封装 useQuery 逻辑，提高复用性
- 返回必要的状态和函数

```js
// hooks/useQuestionsList.js
import { useQuery } from '@tanstack/react-query';
import { getQuestions } from '../api/question.service';

/**
 * 获取错题列表
 * @param {Object} filters - 筛选条件
 */
export const useQuestionsList = (filters = {}) => {
  return useQuery({
    queryKey: ['questions', 'list', filters],
    queryFn: () => getQuestions(filters),
    keepPreviousData: true,
  });
};
```

#### 3.2.4 useMutation 使用规范

- 处理创建、更新、删除操作
- 配置成功回调更新缓存

```js
// hooks/useCreateQuestion.js
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { createQuestion } from '../api/question.service';

export const useCreateQuestion = () => {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: createQuestion,
    onSuccess: (data) => {
      // 成功后使相关查询失效
      queryClient.invalidateQueries({ queryKey: ['questions', 'list'] });
      // 可选：将新创建的错题添加到缓存
      queryClient.setQueryData(['questions', 'detail', data.id], data);
    },
  });
};
```

## 4. 路由管理 (React Router)

### 4.1 路由配置

- 在 `src/router.jsx` 中配置路由
- 使用 `createBrowserRouter` 创建路由

```jsx
// src/router.jsx
import { createBrowserRouter } from 'react-router-dom';
import { lazy, Suspense } from 'react';

// 布局
import MainLayout from './layouts/MainLayout';
import AuthLayout from './layouts/AuthLayout';

// 懒加载页面组件
const LoginPage = lazy(() => import('./pages/LoginPage'));
const DashboardPage = lazy(() => import('./pages/DashboardPage'));
const SubmissionDashboard = lazy(() => import('./pages/SubmissionDashboard'));
const KnowledgeReviewPage = lazy(() => import('./pages/KnowledgeReviewPage'));

// 加载指示器
const Loading = () => <div>加载中...</div>;

// 路由配置
const router = createBrowserRouter([
  {
    path: '/',
    element: <MainLayout />,
    children: [
      {
        index: true,
        element: (
          <Suspense fallback={<Loading />}>
            <DashboardPage />
          </Suspense>
        ),
      },
      {
        path: 'submission',
        element: (
          <Suspense fallback={<Loading />}>
            <SubmissionDashboard />
          </Suspense>
        ),
      },
      {
        path: 'knowledge',
        element: (
          <Suspense fallback={<Loading />}>
            <KnowledgeReviewPage />
          </Suspense>
        ),
      },
    ],
  },
  {
    path: '/login',
    element: (
      <AuthLayout>
        <Suspense fallback={<Loading />}>
          <LoginPage />
        </Suspense>
      </AuthLayout>
    ),
  },
]);

export default router;
```

### 4.2 路由守卫/权限控制

- 使用组件包装实现权限控制

```jsx
// src/components/common/RequireAuth.jsx
import { Navigate, useLocation } from 'react-router-dom';
import { useAuthStore } from '../../stores/authStore';

/**
 * 需要认证才能访问的路由组件
 */
function RequireAuth({ children }) {
  const isAuthenticated = useAuthStore(state => state.isAuthenticated);
  const location = useLocation();
  
  if (!isAuthenticated) {
    // 重定向到登录页，保留原始请求地址
    return <Navigate to="/login" state={{ from: location }} replace />;
  }
  
  return children;
}

export default RequireAuth;

// 在路由配置中使用
{
  path: 'submission',
  element: (
    <RequireAuth>
      <Suspense fallback={<Loading />}>
        <SubmissionDashboard />
      </Suspense>
    </RequireAuth>
  ),
},
```

### 4.3 编程式导航

- 使用 `useNavigate` hook 进行编程式导航

```jsx
import { useNavigate } from 'react-router-dom';

function SubmitButton() {
  const navigate = useNavigate();
  
  const handleSubmit = () => {
    // 提交逻辑
    // ...
    // 成功后导航到其他页面
    navigate('/knowledge');
    
    // 或者带参数
    navigate('/question/123');
    
    // 或者替换当前历史记录
    navigate('/dashboard', { replace: true });
  };
  
  return <button onClick={handleSubmit}>提交</button>;
}
```

## 5. UI 组件库 (Ant Design)

### 5.1 主题定制

- 在 `src/styles/theme.js` 中定制 Ant Design 主题

```jsx
// src/styles/theme.js
const theme = {
  token: {
    colorPrimary: '#1677ff',
    colorSuccess: '#52c41a',
    colorWarning: '#faad14',
    colorError: '#ff4d4f',
    colorInfo: '#1677ff',
    borderRadius: 6,
    fontFamily: "'PingFang SC', 'Microsoft YaHei', sans-serif",
  },
  components: {
    Card: {
      paddingLG: 24,
    },
    Button: {
      paddingInline: 16,
    },
  },
};

export default theme;
```

### 5.2 全局配置

- 在 `App.jsx` 中使用 `ConfigProvider` 应用主题

```jsx
// src/App.jsx
import { ConfigProvider } from 'antd';
import { RouterProvider } from 'react-router-dom';
import router from './router';
import theme from './styles/theme';
import zhCN from 'antd/locale/zh_CN';

function App() {
  return (
    <ConfigProvider theme={theme} locale={zhCN}>
      <RouterProvider router={router} />
    </ConfigProvider>
  );
}

export default App;
```

### 5.3 常用组件封装

- 封装常用的 Ant Design 组件，统一风格和行为

```jsx
// src/components/common/FormSubmitButton.jsx
import { Button } from 'antd';

/**
 * 表单提交按钮组件
 * @param {Object} props
 * @param {string} [props.text='提交'] - 按钮文本
 * @param {boolean} [props.loading=false] - 加载状态
 * @param {Function} props.onClick - 点击回调
 */
function FormSubmitButton({ text = '提交', loading = false, onClick, ...restProps }) {
  return (
    <Button
      type="primary"
      loading={loading}
      onClick={onClick}
      {...restProps}
    >
      {text}
    </Button>
  );
}

export default FormSubmitButton;
```

## 6. Markdown & LaTeX 支持

### 6.1 配置 React Markdown

- 在相关组件中配置 React Markdown 及插件

```jsx
// src/components/common/MarkdownRenderer.jsx
import ReactMarkdown from 'react-markdown';
import remarkMath from 'remark-math';
import rehypeKatex from 'rehype-katex';
import 'katex/dist/katex.min.css';

/**
 * Markdown 渲染组件，支持数学公式
 * @param {Object} props
 * @param {string} props.content - Markdown 内容
 */
function MarkdownRenderer({ content }) {
  return (
    <ReactMarkdown
      remarkPlugins={[remarkMath]}
      rehypePlugins={[rehypeKatex]}
      className="markdown-body"
    >
      {content}
    </ReactMarkdown>
  );
}

export default MarkdownRenderer;
```

### 6.2 LaTeX 独立组件

- 使用 `react-katex` 渲染独立的 LaTeX 公式

```jsx
// src/components/common/MathFormula.jsx
import { InlineMath, BlockMath } from 'react-katex';
import 'katex/dist/katex.min.css';

/**
 * 数学公式渲染组件
 * @param {Object} props
 * @param {string} props.formula - LaTeX 公式
 * @param {boolean} [props.block=false] - 是否为块级公式
 */
function MathFormula({ formula, block = false }) {
  return block ? (
    <BlockMath math={formula} />
  ) : (
    <InlineMath math={formula} />
  );
}

export default MathFormula;
```

## 7. 样式方案

### 7.1 全局样式

- 在 `src/styles/global.css` 中定义全局样式
- 在 `src/index.js` 中引入全局样式

```css
/* src/styles/global.css */
body {
  margin: 0;
  padding: 0;
  font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: #f5f5f5;
}

.markdown-body {
  line-height: 1.6;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3 {
  margin-top: 24px;
  margin-bottom: 16px;
  font-weight: 600;
}

/* 更多全局样式... */
```

### 7.2 Styled Components 使用

- 使用 Styled Components 为组件定义局部样式

```jsx
// src/components/knowledge/KnowledgeCard.jsx
import styled from 'styled-components';
import { Card, Tag, Button } from 'antd';

// 定义样式化组件
const StyledCard = styled(Card)`
  margin-bottom: 16px;
  border-radius: 8px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  
  .ant-card-head-title {
    font-weight: 600;
  }
`;

const KnowledgeTag = styled(Tag)`
  margin: 4px;
  padding: 4px 8px;
`;

const ActionButton = styled(Button)`
  margin-right: 8px;
`;

// 使用样式化组件
function KnowledgeCard({ title, knowledgePoints, isReviewed, onConfirm }) {
  return (
    <StyledCard title={title} extra={isReviewed && <Tag color="success">已审核</Tag>}>
      <div>
        {knowledgePoints.map((point, index) => (
          <KnowledgeTag key={index} color="blue">{point}</KnowledgeTag>
        ))}
      </div>
      <div style={{ marginTop: 16 }}>
        <ActionButton type="primary" onClick={onConfirm}>确认</ActionButton>
        <ActionButton>编辑</ActionButton>
      </div>
    </StyledCard>
  );
}

export default KnowledgeCard;
```

### 7.3 样式变量

- 在一个统一的文件中定义样式变量，确保风格一致性

```js
// src/styles/variables.js
export const colors = {
  primary: '#1677ff',
  success: '#52c41a',
  warning: '#faad14',
  error: '#ff4d4f',
  background: '#f5f5f5',
  cardBackground: '#fff',
  textPrimary: 'rgba(0, 0, 0, 0.85)',
  textSecondary: 'rgba(0, 0, 0, 0.45)',
};

export const spacing = {
  xs: '4px',
  sm: '8px',
  md: '16px',
  lg: '24px',
  xl: '32px',
};

export const shadows = {
  small: '0 1px 2px rgba(0, 0, 0, 0.1)',
  medium: '0 2px 8px rgba(0, 0, 0, 0.15)',
  large: '0 4px 16px rgba(0, 0, 0, 0.1)',
};

// 在 Styled Components 中使用
import { colors, spacing, shadows } from '../../styles/variables';

const Container = styled.div`
  background-color: ${colors.cardBackground};
  padding: ${spacing.lg};
  margin-bottom: ${spacing.md};
  box-shadow: ${shadows.small};
`;
```

## 总结

GradNote 前端项目采用了 React 生态系统的主流技术栈和最佳实践，为开发高质量的现代 Web 应用提供了坚实的基础。遵循本文档中的技术规范和开发约定，可以保证代码质量和一致性，提高团队协作效率，降低维护成本。

各技术栈更多详细信息，请参考官方文档：

- [React 官方文档](https://react.dev/)
- [Zustand 官方文档](https://github.com/pmndrs/zustand)
- [TanStack Query 官方文档](https://tanstack.com/query/latest/docs/react/overview)
- [React Router 官方文档](https://reactrouter.com/en/main)
- [Ant Design 官方文档](https://ant.design/docs/react/introduce-cn)
- [Styled Components 官方文档](https://styled-components.com/docs)
