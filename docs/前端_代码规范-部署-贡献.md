# GradNote-FrontEnd 代码规范、部署与贡献指南

## 一、代码规范与质量

### 1.1 代码风格

- **命名规范**：
  - 组件名使用大驼峰命名法（PascalCase），如 `SubmissionForm`、`KnowledgeCard`
  - 文件名与组件名保持一致，如 `SubmissionForm.jsx`
  - Hook 文件名使用小驼峰命名法（camelCase），前缀为 `use`，如 `useSubmission.js`
  - 事件处理函数以 `handle` 开头，如 `handleSubmit`、`handleImageUpload`
  - 渲染函数以 `render` 开头，如 `renderQuestionForm`、`renderKnowledgePoints`
  - CSS 模块化引入的变量统一命名为 `styles`

- **编码原则**：
  - 遵循函数式编程原则，尽量使用纯函数
  - 优先使用函数组件和 Hooks，避免使用类组件
  - 代码组织清晰，相关代码应该放在一起
  - 避免过长的函数和组件，单个函数建议不超过 50 行
  - import 顺序：第三方依赖 > 样式文件 > 项目内组件/工具

- **注释规范**：
  - 复杂逻辑或不易理解的代码应添加注释
  - 使用 JSDoc 风格注释函数和组件
  - 推荐使用 `/** */` 格式的注释，便于 IDE 解析

```jsx
/**
 * 知识点卡片组件
 * @param {Object} props
 * @param {string} props.title - 卡片标题
 * @param {Array<string>} props.knowledgePoints - 知识点列表
 * @param {Function} props.onConfirm - 确认回调函数
 */
function KnowledgeCard({ title, knowledgePoints, onConfirm }) {
  // 组件实现
}
```

### 1.2 Linting & Formatting

- **ESLint**：项目使用 ESLint 进行代码检查，基于 Airbnb 规范进行适当调整
  - 编辑器应安装 ESLint 插件，实时提示错误
  - 提交代码前会自动运行 ESLint 检查，不符合规范将无法提交

- **Prettier**：使用 Prettier 进行代码格式化
  - 编辑器应安装 Prettier 插件，可配置保存时自动格式化
  - 主要配置：单引号、无分号、2 空格缩进

- **运行检查**：
  ```bash
  # 运行 ESLint 检查
  npm run lint
  
  # 运行 Prettier 格式化
  npm run format
  ```

### 1.3 测试

- **测试框架**：使用 Jest 进行单元测试，使用 React Testing Library 进行组件测试
- **测试覆盖率**：重要模块和组件应有对应的测试用例
- **运行测试**：
  ```bash
  # 运行所有测试
  npm test
  
  # 运行指定测试文件
  npm test -- src/components/KnowledgeCard.test.js
  
  # 查看测试覆盖率
  npm test -- --coverage
  ```

## 二、部署流程

### 2.1 构建流程

项目使用 Create React App 进行构建，构建流程如下：

1. 安装依赖：
   ```bash
   npm install
   ```

2. 本地开发：
   ```bash
   npm start
   ```

3. 构建生产版本：
   ```bash
   npm run build
   ```
   
   构建产物将生成在 `build` 目录下，包含优化后的静态文件。

### 2.2 服务器配置

#### Nginx 配置示例

```nginx
server {
    listen 80;
    server_name gradnote.example.com;
    
    root /var/www/gradnote-frontend/build;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # API 代理
    location /api/ {
        proxy_pass http://backend-server:8000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 30d;
        add_header Cache-Control "public, no-transform";
    }
}
```

#### 静态文件部署步骤

1. 在本地执行 `npm run build` 生成构建产物
2. 将 `build` 目录下所有文件上传到服务器的 `/var/www/gradnote-frontend/build` 目录
3. 确保 Nginx 配置正确并重启 Nginx
   ```bash
   sudo nginx -t
   sudo systemctl restart nginx
   ```

### 2.3 CI/CD 流程

如果项目接入了 CI/CD 系统，其流程如下：

1. 开发者提交代码到 Git 仓库
2. CI 系统自动执行以下步骤：
   - 安装依赖
   - 运行代码检查（ESLint）
   - 运行测试
   - 构建生产版本
3. 如果以上步骤均成功，则自动部署到对应环境
   - 开发分支部署到开发环境
   - 测试分支部署到测试环境
   - 主分支部署到生产环境

## 三、贡献指南

### 3.1 分支策略

项目采用简化版的 Git Flow 工作流，包含以下分支：

- **main**：主分支，对应生产环境，受保护分支
- **develop**：开发主分支，所有功能开发完成后合并到此分支
- **feature/xxx**：功能分支，从 develop 分支创建，完成后合并回 develop 分支
- **hotfix/xxx**：紧急修复分支，从 main 分支创建，修复完成后同时合并到 main 和 develop 分支

### 3.2 Commit Message 规范

项目采用 [Conventional Commits](https://www.conventionalcommits.org/zh-hans/) 规范，格式如下：

```
<类型>[可选的作用域]: <描述>

[可选的正文]

[可选的脚注]
```

常用类型：

- **feat**：新功能
- **fix**：错误修复
- **docs**：文档变更
- **style**：代码格式（不影响代码运行的变动）
- **refactor**：代码重构（既不是新增功能，也不是修改bug的代码变动）
- **perf**：性能优化
- **test**：增加测试
- **chore**：构建过程或辅助工具的变动

示例：
```
feat(knowledge): 添加知识点编辑功能

- 新增知识点编辑表单
- 实现知识点修改和删除功能
- 优化知识点展示样式

Closes #123
```

### 3.3 Code Review 流程

1. 开发者完成功能开发后，创建 Pull Request (PR)
2. 在 PR 中详细描述变更内容、相关需求和测试情况
3. 指定至少一名团队成员进行 Code Review
4. Reviewer 检查以下内容：
   - 代码是否符合项目规范
   - 功能实现是否符合需求
   - 是否有潜在的性能问题
   - 是否有安全隐患
   - 测试是否充分
5. 如有问题，Reviewer 在 PR 中提出意见，开发者进行修改
6. 所有问题解决且通过 CI 检查后，由有权限的成员进行合并

### 3.4 Bug 与 Issue 提报

1. 在项目仓库的 Issue 页面创建新 Issue
2. 使用提供的 Bug 报告模板，包含以下信息：
   - Bug 简要描述
   - 复现步骤
   - 预期行为
   - 实际行为
   - 环境信息（浏览器版本、操作系统等）
   - 截图或录屏（如有）
3. 为 Issue 添加合适的标签，如 `bug`、`高优先级` 等
4. 项目管理员会对 Issue 进行分类和分配

## 四、常见问题解答

### 4.1 本地开发环境配置问题

**Q: 如何处理本地开发时的跨域问题？**

A: 可以在 `package.json` 中添加 `proxy` 字段，指向后端 API 地址：
```json
{
  "proxy": "http://localhost:8000"
}
```

**Q: 如何配置不同环境的环境变量？**

A: 创建不同的环境变量文件：
- `.env`：默认环境变量
- `.env.development`：开发环境变量
- `.env.production`：生产环境变量

注意：环境变量必须以 `REACT_APP_` 开头才能被 Create React App 识别。

### 4.2 常见错误及解决方案

**Q: 提交代码时出现 ESLint 错误怎么办？**

A: 运行 `npm run lint:fix` 尝试自动修复，对于无法自动修复的错误，需手动修改代码以符合规范。

**Q: 构建时遇到内存溢出问题怎么办？**

A: 增加 Node.js 内存限制：
```bash
export NODE_OPTIONS=--max_old_space_size=4096
npm run build
```

---

本文档由团队共同维护，如有疑问或建议，请通过 Issue 或团队内部沟通渠道反馈。
